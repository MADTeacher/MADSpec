---
description: MVP - Этап 5 - Пошаговая реализация проекта с автоматической валидацией и отслеживанием прогресса
scripts:
  sh: scripts/bash/get-branch.sh
  ps: scripts/powershell/get-branch.ps1
---

## Пользовательский ввод

```text
$ARGUMENTS
```

Ты **ОБЯЗАН** учитывать пользовательский ввод перед продолжением (если он не пустой).

## Правила диалога (обязательно)

- **Задавай вопросы строго по одному**: в каждом твоем сообщении должен быть **ровно 1 вопрос**, который требует ответа.
- **Не выдавай список вопросов заранее** (никаких длинных анкет/чек-листов вопросов за раз).
- Если нужен выбор, задай **один вопрос** и предложи **не больше 3–5 вариантов** (или попроси свободный ответ).
- **Дожидайся ответа** и только затем задавай следующий вопрос.
- Если ответ неполный — задай **один уточняющий вопрос**, а не несколько сразу.

## Описание

Этот этап **MADSpec (MADSpec Framework)** выполняет пошаговую реализацию **MVP (Minimum Viable Product)** проекта согласно плану. Каждый шаг:

**Режим MVP**: Эта команда предназначена для разработки нового проекта с нуля. Все артефакты сохраняются в `.madspec/<BRANCH>/`, где `<BRANCH>` - имя текущей ветки разработки.
- Выполняется последовательно (с учетом зависимостей)
- Валидируется через тесты
- Отмечается как завершенный в `.madspec/<BRANCH>/memory/progress.json` (где `<BRANCH>` определяется через скрипт)
- Может быть возобновлен с любого шага

## Предварительные условия

- Должен существовать `.madspec/<BRANCH>/implementation-plan.md` (где `<BRANCH>` определяется через скрипт)
- Должна существовать директория `.madspec/<BRANCH>/steps/` с описаниями шагов
- Должен существовать `.madspec/<BRANCH>/memory/progress.json`
- Если файлы отсутствуют, предложи выполнить `/madspec.mvp.plan`

## Цель этапа

Реализовать проект пошагово, обеспечивая:
- Выполнение каждого шага согласно плану
- Валидацию через автоматические и ручные тесты
- Отслеживание прогресса
- Возможность возобновления с любого шага

0. **Определение текущей ветки**:
   - **ВАЖНО**: Перед началом работы определи текущую ветку, выполнив `{SCRIPT}` из корня проекта
   - Скрипт возвращает имя ветки через stdout
   - Используй результат выполнения скрипта (имя ветки) для формирования путей к артефактам
   - Все пути к артефактам должны быть в формате `.madspec/<BRANCH>/...`, где `<BRANCH>` - это имя ветки, полученное из скрипта
   - Если ни скрипт, ни файл недоступны, используй значение по умолчанию `main`
   - Сохрани имя ветки для использования в дальнейших шагах

1. **Загрузка контекста**:
   - Прочитай `.madspec/<BRANCH>/implementation-plan.md` (где `<BRANCH>` - имя ветки, определенное в шаге 0)
   - Прочитай `.madspec/<BRANCH>/memory/progress.json`
   - Прочитай все предыдущие артефакты (concept, design, tech, architecture) из `.madspec/<BRANCH>/`
   - **ОБЯЗАТЕЛЬНО**: Прочитай контексты планирования и реализации предыдущих шагов (если есть):
     - `.madspec/<BRANCH>/steps/step-[NN-1]-[prev-name]/planning-context.md` (контекст планирования предыдущего шага)
     - `.madspec/<BRANCH>/steps/step-[NN-1]-[prev-name]/implementation-context.md` (контекст реализации предыдущего шага)
     - Это поможет понять решения и проблемы предыдущих шагов
   - **ВАЖНО**: Используй HTML прототипы из `.madspec/<BRANCH>/ui-prototype/` как референс при реализации:
     - Открой соответствующий HTML файл для каждого экрана
     - Используй прототип как визуальный гайд для реализации
     - Убедись, что реализованный интерфейс соответствует прототипу

2. **Определение начального шага**:
   - Если `.madspec/<BRANCH>/memory/progress.json` указывает на `currentImplementStep`, начните с него
   - Если `currentImplementStep` равен `null`, начните с первого шага
   - Если пользователь указал конкретный шаг в `$ARGUMENTS`, используй его

3. **Проверка зависимостей**:
   - Для текущего шага проверь, что все зависимости завершены
   - Если зависимости не завершены, сообщи об ошибке и укажи, какие шаги нужно завершить сначала

3.5. **Формат именования шагов**:
   - Формат имени шага: `step-[NN]-[name]`, где:
     - `[NN]` — номер шага в формате двух цифр с ведущим нулем (01, 02, 03, ..., 10, 11, ...)
     - `[name]` — краткое название шага на английском языке (например: `setup`, `user-model`, `auth`)
   - Источники информации о шагах:
     - **Номер шага `[NN]`** берется из:
       - `.madspec/<BRANCH>/implementation-plan.md` (где шаги перечислены с номерами)
       - `.madspec/<BRANCH>/memory/progress.json` (поле `plannedSteps` содержит список шагов в формате `step-[NN]-[name]`)
       - Названий директорий в `.madspec/<BRANCH>/steps/` (если директории уже существуют)
     - **Название шага `[name]`** берется из:
       - `.madspec/<BRANCH>/implementation-plan.md` (название шага в плане)
       - Названия директории в `.madspec/<BRANCH>/steps/` (если директория уже существует)
       - `.madspec/<BRANCH>/memory/progress.json` (поле `plannedSteps` или `currentImplementStep`)
   - Примеры: `step-01-setup`, `step-02-user-model`, `step-03-auth`, `step-10-api-integration`
   - **ВАЖНО**: При определении текущего шага используй точное имя из `.madspec/<BRANCH>/memory/progress.json` или `implementation-plan.md`, не придумывай формат самостоятельно

4. **Загрузка описания шага**:
   - Прочитай `.madspec/<BRANCH>/steps/step-[NN]-[name]/description.md`
   - Прочитай `.madspec/<BRANCH>/steps/step-[NN]-[name]/tasks.md`
   - Прочитай `.madspec/<BRANCH>/steps/step-[NN]-[name]/tests.md`
   - Прочитай `.madspec/<BRANCH>/steps/step-[NN]-[name]/validation.md`
   - **Примечание**: `[NN]` и `[name]` определяются из текущего шага (см. раздел 2.5)

5. **Выполнение шага**:
   - Выполни все задачи из `tasks.md`
   - Следуй описанию из `description.md`
   - Создавай/модифицируй файлы согласно задачам
   - Отмечай выполненные задачи в `tasks.md` (чекбоксы `[x]`)
   - **Примечание**: Файл `tasks.md` находится в `.madspec/<BRANCH>/steps/` и может быть частью репозитория. Если файл недоступен для редактирования, веди учет выполненных задач в отдельном файле или комментариях.

5.1. **⚠️ КРИТИЧЕСКИ ВАЖНО: Использование официальных команд создания проектов**:

   **ЗАПРЕЩЕНО** создавать проекты вручную, добавляя файлы и директории самостоятельно. **ОБЯЗАТЕЛЬНО** используй официальные команды создания проектов для соответствующих технологий:

   - **Flutter**: Используй `flutter create <project_name>` вместо ручного создания файлов и директорий
   - **React**: Используй `npx create-react-app <project_name>` или `npm create vite@latest <project_name>` вместо ручного создания файлов
   - **Next.js**: Используй `npx create-next-app@latest <project_name>` вместо ручного создания файлов
   - **Vue.js**: Используй `npm create vue@latest <project_name>` или `vue create <project_name>` вместо ручного создания файлов
   - **Angular**: Используй `ng new <project_name>` вместо ручного создания файлов
   - **Go**: Используй `go mod init <module_name>` для инициализации модуля вместо ручного создания `go.mod`
   - **Python (uv)**: 
     - **Для новых проектов**: Используй `uv init <project_name>` для создания нового проекта в новой директории или `uv init` для инициализации в текущей директории
     - **Для библиотек**: Используй `uv init --lib <project_name>` для создания библиотеки
     - **Для упакованных приложений**: Используй `uv init --package <project_name>` для создания проекта с правильной структурой пакета (исходный код в `src/`)
     - **Для виртуальных окружений**: Используй `uv venv` для создания виртуального окружения (создается автоматически при первом запуске `uv run`, `uv sync` или `uv lock`)
     - **Для установки зависимостей**: Используй `uv add <package>` для добавления зависимостей в проект
     - **Для синхронизации**: Используй `uv sync` для синхронизации зависимостей из `uv.lock`
     - **Для создания lockfile**: Используй `uv lock` для создания/обновления `uv.lock`
     - **Для запуска скриптов**: Используй `uv run <script>` для запуска скриптов в изолированном окружении
     - **НЕ СОЗДАВАЙ** файлы `pyproject.toml`, `.python-version`, `uv.lock` вручную - они создаются командами uv
   - **Python (традиционные инструменты)**: 
     - Используй `python -m venv <venv_name>` для создания виртуального окружения (если uv не используется)
     - Используй `pip install` для установки зависимостей (если uv не используется)
     - Используй соответствующие команды для создания проектов (например, `django-admin startproject <project_name>` для Django)
   - **Node.js**: Используй `npm init` или `npm init -y` для создания `package.json` вместо ручного создания файла
   - **Rust**: Используй `cargo new <project_name>` вместо ручного создания файлов и директорий
   - **Java**: Используй соответствующие команды Maven/Gradle для создания проекта (например, `mvn archetype:generate` или `gradle init`)
   - **C#/.NET**: Используй `dotnet new <template>` для создания проектов вместо ручного создания файлов
   - **Ruby**: Используй `rails new <project_name>` для Rails проектов вместо ручного создания файлов
   - **PHP**: Используй `composer create-project` для создания проектов вместо ручного создания файлов

   **Правила использования команд**:
   - Перед созданием проекта проверь, установлен ли необходимый инструмент (flutter, npm, go, python, uv и т.д.)
   - Если инструмент не установлен, сообщи пользователю о необходимости его установки
   - Выполняй команды создания проектов из корневой директории проекта (или указанной в `tasks.md` директории)
   - После выполнения команды создания проекта проверь, что все необходимые файлы и директории были созданы
   - Если команда создания проекта требует дополнительных параметров (например, выбор шаблона, типа проекта), используй параметры по умолчанию или следуй инструкциям из `tasks.md` или `description.md`
   - **НЕ СОЗДАВАЙ** файлы конфигурации (например, `package.json`, `go.mod`, `pubspec.yaml`, `Cargo.toml`, `pyproject.toml`, `.python-version`, `uv.lock`) вручную - они должны быть созданы соответствующими командами
   - **НЕ СОЗДАВАЙ** структуру директорий проекта вручную - она должна быть создана соответствующими командами

   **Примеры правильного использования**:
   - ✅ `flutter create my_app` - правильно
   - ❌ Создание файлов `pubspec.yaml`, `lib/main.dart` и директорий вручную - неправильно
   - ✅ `npx create-react-app my-app` - правильно
   - ❌ Создание файлов `package.json`, `src/App.js` и директорий вручную - неправильно
   - ✅ `go mod init example.com/myproject` - правильно
   - ❌ Создание файла `go.mod` вручную - неправильно
   - ✅ `uv init my_project` - правильно для создания нового Python проекта с uv
   - ✅ `uv init --lib my_library` - правильно для создания библиотеки с uv
   - ✅ `uv init --package my_app` - правильно для создания упакованного приложения с uv
   - ✅ `uv add requests` - правильно для добавления зависимости в проект uv
   - ✅ `uv venv` - правильно для создания виртуального окружения с uv
   - ❌ Создание файлов `pyproject.toml`, `.python-version`, `uv.lock` и директорий вручную - неправильно
   - ❌ Создание директории `.venv` и файлов вручную - неправильно


6. **Валидация шага**:
   
   **ВАЖНО**: Перед переходом к следующему шагу выполни полную валидацию текущего шага по следующему чек-листу:
   
   - [ ] **Все задачи из `tasks.md` выполнены**
     - Проверь файл `.madspec/<BRANCH>/steps/step-[NN]-[name]/tasks.md`
     - Все задачи должны быть отмечены как выполненные (чекбоксы `[x]`)
     - Все файлы, указанные в задачах, должны быть созданы или изменены
     - **Если не выполнено**: выполни недостающие задачи
   
   - [ ] **Автоматические тесты описаны**
     - Проверь файл `.madspec/<BRANCH>/steps/step-[NN]-[name]/tests.md` на наличие описания автоматических тестов
     - Если тесты указаны, проверь их наличие в кодовой базе проекта
     - Все тесты должны проходить успешно
     - **Если тесты нет, но они требуются в рамках текущего шага**: исправь проблемы и повтори проверки
     - **Если тестов нет и они не требуются на текущем шаге проекта**: пропусти этот пункт
   
   - [ ] **Ручные тесты описаны**
     - Проверь файл `.madspec/<BRANCH>/steps/step-[NN]-[name]/tests.md` на наличие ручных тестов/чек-листов
     - **Если ручных тестов нет, но они требуются на данном шаге**: исправь проблемы и повтори проверки
   
   - [ ] **Критерии завершения из `validation.md` выполнены**
     - Прочитай файл `.madspec/<BRANCH>/steps/step-[NN]-[name]/validation.md`
     - Проверь каждый критерий успешного завершения
     - Убедись, что реализация соответствует всем критериям
     - **Если критерии не выполнены**: доработай реализацию до соответствия критериям
   
   - [ ] **Реализация соответствует описанию шага**
     - Сравни реализованный код с описанием из `description.md`
     - Убедись, что реализация соответствует целям шага
     - **Если не соответствует**: пересмотри реализацию
   
   - [ ] **Код соответствует архитектуре проекта**
     - Проверь, что созданные файлы находятся в правильных директориях согласно архитектуре
     - Убедись, что код следует принципам из `.madspec/<BRANCH>/architecture.md`
     - **Если не соответствует**: приведи код в соответствие с архитектурой
   
   - [ ] **HTML прототипы учтены (если шаг касается UI)**
     - Если шаг связан с реализацией интерфейса (создание компонентов, страниц, форм, стилей), проверь соответствие HTML прототипам из `.madspec/ui-prototype/`
     - Реализованный интерфейс должен визуально соответствовать прототипу
     - **Если не соответствует**: приведи интерфейс в соответствие с прототипом
   
   **Если валидация не пройдена:**
   - Укажи конкретные пункты, которые не выполнены
   - Предложи конкретные исправления
   - **НЕ ПРОДОЛЖАЙ** к следующему шагу до прохождения валидации
   - **НЕ СОЗДАВАЙ** коммит в GIT до успешной валидации
   
   **Если валидация пройдена:**
   - Подтверди успешную валидацию шага
   - Переходи к обновлению прогресса (раздел 6)

6. **Обновление прогресса**:
   
   **ВАЖНО**: После успешной валидации шага обнови файл `.madspec/<BRANCH>/memory/progress.json` вручную:
   
   - Прочитай текущий файл `.madspec/<BRANCH>/memory/progress.json`
   - Выполни следующие обновления:
     
     a. **Добавь текущий шаг в `completedSteps`**:
        - Если шаг еще не присутствует в массиве `completedSteps`, добавь его
        - Формат: `"step-[NN]-[name]"` (например, `"step-01-setup"`)
     
     b. **Обнови `stepStatus` для текущего шага**:
        - Установи `stepStatus["step-[NN]-[name]"]` как объект с полями:
          - `status`: `"completed"`
          - `completedAt`: `"YYYY-MM-DD"` (дата завершения в формате ISO)
        - Пример: `stepStatus["step-01-setup"] = {"status": "completed", "completedAt": "2024-01-15"}`
     
     c. **Определи следующий шаг**:
        - Найди следующий незавершенный шаг из `plannedSteps` в `.madspec/<BRANCH>/memory/progress.json` (если поле существует)
        - Или найди следующий шаг из `implementation-plan.md`, который еще не завершен
        - Учитывай зависимости: следующий шаг должен иметь все зависимости в `completedSteps`
        - Если зависимости указаны в `planningMetadata.stepDependencies`, проверь их там
        - Если следующий шаг найден и все его зависимости завершены, установи `currentImplementStep = "step-[NN]-[name]"`
        - Если все шаги завершены, установи `currentImplementStep = null`
     
     d. **Сохрани обновленный `.madspec/<BRANCH>/memory/progress.json`**:
        - Убедись, что JSON валиден (правильный синтаксис, запятые, кавычки)
        - Сохрани файл
   
   **Пример обновления `.madspec/<BRANCH>/memory/progress.json`**:
   
   До обновления:
   ```json
   {
     "currentImplementStep": "step-01-setup",
     "completedSteps": [],
     "plannedSteps": ["step-01-setup", "step-02-user-model", "step-03-auth"],
     "stepStatus": {},
     "planningMetadata": {
       "stepDependencies": {
         "step-02-user-model": ["step-01-setup"],
         "step-03-auth": ["step-02-user-model"]
       }
     }
   }
   ```
   
   После обновления (после завершения step-01-setup):
   ```json
   {
     "currentImplementStep": "step-02-user-model",
     "completedSteps": ["step-01-setup"],
     "plannedSteps": ["step-01-setup", "step-02-user-model", "step-03-auth"],
     "stepStatus": {
       "step-01-setup": {
         "status": "completed",
         "completedAt": "2024-01-15"
       }
     },
     "planningMetadata": {
       "stepDependencies": {
         "step-02-user-model": ["step-01-setup"],
         "step-03-auth": ["step-02-user-model"]
       }
     }
   }
   ```
   
   **Примечание**: Поле `plannedSteps` и `planningMetadata` обычно не изменяются на этапе реализации, они создаются на этапе планирования. Обновляй только `currentImplementStep`, `completedSteps` и `stepStatus`.
   
   **ВАЖНО**: 
   - Обновляй `.madspec/<BRANCH>/memory/progress.json` только после успешной валидации шага
   - Проверяй валидность JSON после каждого обновления
   - Не удаляй существующие данные из `.madspec/<BRANCH>/memory/progress.json`, только добавляй новые

6.5. **Создание контекста реализации**:
   
   После успешной валидации шага создай `.madspec/<BRANCH>/steps/step-[NN]-[name]/implementation-context.md`:
     - Используй шаблон `.madspec/templates/implementation-context-template.md` (шаблоны хранятся в корне `.madspec/templates/`)
   - Заполни все разделы шаблона:
     - **Краткое резюме реализации**: что было сделано на этом шаге
     - **Отклонения от плана**: если были (или укажи "Отклонений от плана не было")
     - **Ключевые решения при реализации**: решения, принятые во время реализации с альтернативами
     - **Проблемы и их решения**: проблемы, с которыми столкнулись (или укажи "Значительных проблем не возникло")
     - **Изменения в архитектуре**: если были (или укажи "Изменений в архитектуре не требовалось")
     - **Созданные/измененные файлы**: полный список с описаниями
     - **Результаты тестирования**: статус автоматических и ручных тестов, результат валидации
     - **Информация о коммите**: оставь пустым - будет заполнено после создания коммита
     - Сохрани в `.madspec/<BRANCH>/steps/step-[NN]-[name]/implementation-context.md`
   
   **Примечание**: Информация о коммите будет добавлена после создания коммита в разделе 7

7. **Коммит изменений в GIT**:
   - **ОБЯЗАТЕЛЬНО**: После успешной валидации шага и обновления `.madspec/<BRANCH>/memory/progress.json` создай коммит в GIT
   - Добавь все изменения, включая обновленный `.madspec/<BRANCH>/memory/progress.json`: `git add .`
   - Создай коммит с описанием шага:
     - Формат: `git commit -m "feat(step-NN): реализован шаг [название шага]"`
     - Пример: `git commit -m "feat(step-01): реализована настройка проекта"`
   - **Примечание**: Все изменения шага (код, тесты, документация, обновленный `.madspec/<BRANCH>/memory/progress.json`, `implementation-context.md`) должны быть включены в один коммит. Если тесты добавляются позже, создай отдельный коммит: `git commit -m "test(step-NN): добавлены тесты для шага [название]"`
   - **ВАЖНО**: Коммит создается только после успешной валидации шага
   - Если валидация не пройдена, НЕ создавай коммит до исправления ошибок
   
   - **После создания коммита**: Обнови `implementation-context.md`:
     - Получи хеш коммита: `git log -1 --format=%H`
     - Получи сообщение коммита: `git log -1 --format=%s`
     - Добавь эту информацию в раздел "Информация о коммите" в `.madspec/<BRANCH>/steps/step-[NN]-[name]/implementation-context.md`:
       - Хеш коммита
       - Сообщение коммита
       - Дата коммита
       - Краткое описание всех включенных изменений

8. **Обновление project-context.md**:
   - Обнови `.madspec/<BRANCH>/project-context.md`:
     - Установи текущий этап: "implement"
     - Обнови текущий шаг реализации
     - Обнови прогресс реализации ([X/Y шагов завершено])
     - Добавь/обнови информацию о завершенном шаге в раздел "Шаги реализации":
       - Номер и название шага
       - Ссылка на `implementation-context.md` в директории шага
       - Статус: "Завершен"

9. **Отчет о прогрессе**:
   - Выведи статус выполнения:
     - Текущий шаг завершен
     - Следующий шаг
     - Общий прогресс (X из Y шагов)

10. **Переход к следующему шагу**:
   - Если есть следующий шаг, спроси: "Перейти к следующему шагу? (да/нет/начать тестирование)"
   - Если "да", попроси открыть новый чат и снова запустить текущую команду
   - Если "нет" или "остановиться", сохрани прогресс и заверши работу
   - Если "начать тестирование", выполни автоматизированное тестирование текущего шага и опиши какие шаги необходимо выполнить для ручной проверки работоспособности системы на данном шаге разработки

11. **Завершение**:
    - Когда все шаги завершены, выведи финальный отчет
    - Предложи финальную валидацию проекта
    - Поздравь с завершением!

## Правила выполнения

- **СЛЕДУЙ** плану - не пропускай шаги
- **ВАЛИДИРУЙ** каждый шаг перед переходом к следующему (используй чек-лист из раздела 5)
- **ОБНОВЛЯЙ** `.madspec/<BRANCH>/memory/progress.json` вручную после каждого успешно завершенного шага (см. раздел 6)
- **КОММИТЬ** изменения в GIT после каждого успешно завершенного шага (только после валидации)
- **НЕ ПРОДОЛЖАЙ** если валидация не пройдена
- **НЕ КОММИТЬ** изменения до успешной валидации шага
- **НЕ ОБНОВЛЯЙ** `.madspec/<BRANCH>/memory/progress.json` до успешной валидации шага
- **ДОКУМЕНТИРУЙ** любые отклонения от плана

## Обработка ошибок

- Если шаг не может быть выполнен, остановись и сообщи о проблеме
- Предложи варианты решения
- Если нужно изменить план, задокументируйте изменения

## Подсказки и помощь

### Контекстные подсказки
При возникновении ошибок валидации система автоматически предложит подсказки для решения проблем в реализации.

## Выходные артефакты

- Реализованный код проекта
- Обновленный `.madspec/<BRANCH>/memory/progress.json` (где `<BRANCH>` - имя текущей ветки)
- `.madspec/<BRANCH>/steps/step-[NN]-[name]/implementation-context.md` - контекст реализации каждого шага с решениями
- Документация изменений (если были отклонения от плана)
- История коммитов GIT с коммитом для каждого завершенного шага
- Обновленный `.madspec/<BRANCH>/project-context.md` (навигация и ссылки)

## Завершение

После завершения всех шагов проект готов! Предложи:
- Финальную проверку всех функций
- Демонстрацию проекта
- Рефлексию над процессом разработки

