---
description: Этап 2 - Выбор технологического стека с обоснованием и обсуждением
handoffs: 
  - label: Создать архитектуру
    agent: madspec.architecture
    prompt: Создай архитектуру проекта на основе стека
scripts:
  sh:
  ps:
---

## Пользовательский ввод

```text
$ARGUMENTS
```

Ты **ОБЯЗАН** учитывать пользовательский ввод перед продолжением (если он не пустой).

## Правила диалога (обязательно)

- **Задавай вопросы строго по одному**: в каждом твоем сообщении должен быть **ровно 1 вопрос**, который требует ответа.
- **Не выдавай список вопросов заранее** (никаких длинных анкет/чек-листов вопросов за раз).
- Если нужен выбор, задай **один вопрос** и предложи **не больше 3–5 вариантов** (или попроси свободный ответ).
- **Дожидайся ответа** и только затем задавай следующий вопрос.
- Если ответ неполный — задай **один уточняющий вопрос**, а не несколько сразу.

## Описание

На этом этапе **MADSpec (MADSpec Framework)** выбирается технологический стек для проекта. Это критически важный этап, так как необходимо понимать **ПОЧЕМУ** выбираются те или иные технологии, а не просто следовать рекомендациям.

## Предварительные условия

- Должен существовать `.madspec/concept.md`
- Должен существовать `.madspec/ui-design.md` (утвержденный)
- Если файлы отсутствуют, предложи выполнить предыдущие этапы

## Цель этапа

Выбрать технологический стек, который:
- Подходит для реализации дизайна и функций из концепции
- Имеет обоснование для каждого выбора
- Учитывает ограничения и предпочтения
- Соответствует лучшим практикам для типа проекта

## Рабочий процесс

0. **Загрузка контекста**:
   - Прочитай `.madspec/concept.md`
   - Прочитай `.madspec/ui-design.md`
   - Прочитай `.madspec/project-context.md`
   - Определи тип проекта (веб, мобильное, десктоп, API, и т.д.)

1. **Проверка предпочтений**:
   - Если в пользовательском вводе уже содержатся требования по тем технологиям (язык программирования, библиотеки и/или фреймворки), которые необходимо использовать в разрабатываемом проекте - **переходи к шагу 2**
   - Спроси: "Есть ли у тебя предпочтения по технологиям или ограничения? (например, что нужно использовать Python 3.13 для серверной части, а Flutter 3.38 для клиентской, какие версии библиотек следует добавить в проект или, что запрещено использовать какую-то конкретную технологию. Например - React)"
   - Если есть предпочтения, задокументируй их
   - Если нет, переходи к анализу требований

2. **Анализ требований проекта**:
   - На основе концепции и дизайна определи технические требования:
     - Тип приложения (SPA, SSR, мобильное, десктоп)
     - Необходимость реального времени (WebSocket, gRPC и т.д.)
     - Требования к производительности
     - Масштаб проекта
     - Интеграции с внешними сервисами

3. **Генерация предложений по технологиям**:

   Для каждого компонента стека (язык, фреймворк, БД, и т.д.):

   a. **Определение вариантов**:
      - Предложи 2-3 варианта технологий
      - Учитывай предпочтения (если есть)

   b. **Создание обоснования**:
      - Для каждого варианта укажи:
        - **Плюсы**: Преимущества для данного проекта
        - **Минусы**: Недостатки и ограничения
        - **Когда использовать**: Идеальные сценарии
        - **Сложность обучения**: Насколько легко освоить
        - **Сообщество и поддержка**: Доступность ресурсов

   c. **Рекомендация**:
      - Укажи рекомендуемый вариант с обоснованием
      - Объясни, почему именно этот вариант лучше для проекта

4. **Обсуждение**:
   - Представь предложения в формате таблицы или списка
   - Для каждого компонента спроси: "Согласен с выбором [технология]? (да/нет/другое)"
   - Если "другое", попроси указать альтернативу и обсуди ее
   - Если "нет", обсуди альтернативы и приди к согласию
   - **НЕ ПЕРЕХОДИ** к следующему этапу пока не получишь ответы по всем компонентам

   - Обсуди подходы к организации кода:
     - Feature-first vs Layer-first
     - Monorepo (**предпочительнее**) vs отдельные репозитории
     - Модульная архитектура
   - Предложи рекомендацию с обоснованием
   - Получи согласие
   - **НЕ ПЕРЕХОДИ** к следующему этапу пока не выбран подход для организации кода

5. **Создание документации стека**:
   - Загрузи шаблон `.madspec/templates/tech-stack-template.md` 
   - Замени токены-заполнители в квадратных скобках (например, [БИБЛИОТЕКА_1], [ИНСТРУМЕНТ]) на конкретные значения, полученные в ходе утверждения технического стека проекта
   - Добавь обоснование для каждого выбора
   - Сохрани в `.madspec/tech-stack.md`
   - Создай `.madspec/tech-rationale.md` с детальным обоснованием
   - Обнови `.madspec/project-context.md` (только навигацию)

6. **Валидация выбора технологий**:
   
   **ВАЖНО**: Перед сохранением файлов выполни полную валидацию выбора технологий по следующему чек-листу:
   
   - [ ] **Каждый выбор технологии обоснован**
     - Для каждого компонента стека есть обоснование выбора
     - Указаны преимущества выбранной технологии для проекта
     - **Если не выполнено**: добавь обоснование для каждого выбора
   
   - [ ] **Альтернативы рассмотрены и обсуждены**
     - Для каждого компонента рассмотрены 2-3 альтернативы
     - Указаны плюсы и минусы каждой альтернативы
     - Объяснено, почему выбранная технология лучше для проекта
     - **Если не выполнено**: обсуди альтернативы для каждого компонента
   
   - [ ] **Стек совместим и проверен**
     - Все технологии совместимы друг с другом
     - Нет конфликтующих зависимостей
     - Стек проверен на совместимость
     - **Если не выполнено**: проверь совместимость стека
   
   - [ ] **Учтены ограничения и предпочтения**
     - Если были предпочтения, они учтены
     - Если были ограничения, они учтены
     - Объяснены последствия учета предпочтений/ограничений
     - **Если не выполнено**: обсуди предпочтения и ограничения
   
   - [ ] **Стек подходит для реализации дизайна**
     - Выбранные технологии позволяют реализовать все экраны из дизайна
     - Учтены требования к платформам
     - **Если не выполнено**: обсуди соответствие стека дизайну
   
   - [ ] **Документация стека создана**
     - Файл `.madspec/tech-stack.md` создан и заполнен
     - Файл `.madspec/tech-rationale.md` создан с детальным обоснованием
     - **Если не выполнено**: создай документацию
   
   **ВАЖНО**: **НЕ ПЕРЕХОДИ** к следующему этапу, пока валидация не пройдена успешно
   
   **Если валидация не пройдена:**
   - Укажи конкретные пункты, которые не выполнены
   - Предложи конкретные исправления
   - **НЕ ПРОДОЛЖАЙ** до успешного прохождения валидации
   
   **Если валидация пройдена:**
   - Подтверди успешную валидацию
   - Переходи к обновлению контекста

7. **Обновление контекста**:
   - Обнови `.madspec/project-context.md` с информацией о стеке
   - Добавь ссылки на документацию выбранных технологий

8. **Отчет**:
   - Выведи путь к созданным файлам
   - Предложи перейти к следующему этапу (архитектура)

## Правила

- **ВСЕГДА** предоставляй обоснование для каждого выбора
- **ОБСУЖДАЙ** альтернативы, даже если рекомендация очевидна
- **УЧИТЫВАЙ** предпочтения, но объясняй последствия
- **НЕ** навязывай технологии без объяснения

## Компоненты стека для рассмотрения

- Язык программирования
- Frontend фреймворк/библиотека (если применимо)
- Backend фреймворк (если применимо)
- База данных
- Инструменты тестирования
- Инструменты сборки/развертывания
- Дополнительные библиотеки и зависимости

## Выходные артефакты

- `.madspec/tech-stack.md` - выбранный технологический стек
- `.madspec/tech-rationale.md` - детальное обоснование выбора
- `.madspec/project-context.md` - обновленный контекст проекта

## Следующий этап

После выбора технологий переходите к `/madspec.architecture` для проектирования архитектуры и структуры проекта.

